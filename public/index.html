<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>귀멸의 칼날: 혈귀 대결 - 온라인</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="gameContainer">
        <canvas id="canvas" width="1000" height="600"></canvas>
        <div id="ui">
            <!-- 연결 상태 -->
            <div class="connection-status">
                <span>상태: </span>
                <span id="connectionStatus" class="disconnected">연결 중...</span>
            </div>

            <!-- 캐릭터 선택 화면 -->
            <div id="characterSelect" class="screen">
                <div class="character-select">
                    <h3>캐릭터 선택</h3>
                    <button class="character-btn" data-char="tanjiro">
                        <strong>탄지로</strong><br>
                        <small>물의 호흡 · 만능형</small>
                    </button>
                    <button class="character-btn" data-char="zenitsu">
                        <strong>젠이츠</strong><br>
                        <small>번개의 호흡 · 유리대포</small>
                    </button>
                    <button class="character-btn" data-char="akaza">
                        <strong>아카자</strong><br>
                        <small>파괴살 · 탱커</small>
                    </button>
                    <button class="character-btn" data-char="doma">
                        <strong>도우마</strong><br>
                        <small>빙결술 · 조닝</small>
                    </button>
                </div>

                <button id="findMatchBtn" disabled>매치 찾기</button>

                <div class="character-info" id="characterInfo" style="display: none;">
                    <h4 id="charName"></h4>
                    <div id="charStats"></div>
                    <div id="charSkills"></div>
                </div>
            </div>

            <!-- 대기 화면 -->
            <div id="waitingScreen" class="screen" style="display: none;">
                <div class="waiting-animation">
                    <h3>매치를 찾는 중...</h3>
                    <div class="spinner"></div>
                    <p>상대방을 기다리고 있습니다.</p>
                </div>
                <button id="cancelMatchBtn">매치 취소</button>
            </div>

            <!-- 게임 중 UI -->
            <div id="gameArea" class="screen" style="display: none;">
                <div class="game-stats">
                    <div class="player-info">
                        <h4>나</h4>
                        <div class="health-bar">
                            <div class="health-fill" id="myHealth" style="width: 100%"></div>
                        </div>
                        <div id="mySkills" class="skills-display"></div>
                    </div>

                    <div class="vs-indicator">VS</div>

                    <div class="player-info">
                        <h4>상대방</h4>
                        <div class="health-bar">
                            <div class="health-fill" id="opponentHealth" style="width: 100%"></div>
                        </div>
                    </div>
                </div>

                <div class="controls">
                    <strong>조작법:</strong><br>
                    WASD: 이동 | Space: 기본공격<br>
                    N: 스킬1 | M: 스킬2 | 쉼표(,): 궁극기
                </div>
            </div>

            <!-- 게임 로그 -->
            <div class="game-log" id="gameLog"></div>
        </div>
    </div>

    <!-- Socket.IO 클라이언트 -->
    <script src="/socket.io/socket.io.js"></script>
    
    <!-- 공유 데이터 -->
    <script>
        // 서버의 characterData를 클라이언트에서도 사용
        const characterData = {
            tanjiro: {
                name: '카마도 탄지로',
                hp: 1000,
                atk: 100,
                def: 50,
                speed: 100,
                color: '#3498db',
                description: '물의 호흡과 해의 호흡을 사용하는 만능형 캐릭터',
                skills: {
                    basic: { name: '물의 호흡, 제10형: 생생유전', damage: 50, cooldown: 1000 },
                    skill1: { name: '물의 호흡, 제2형: 물방아', damage: 200, cooldown: 8000 },
                    skill2: { name: '물의 호흡, 제6형: 비틀린 소용돌이', damage: 150, cooldown: 6000 },
                    ultimate: { name: '해의 호흡, 제13형', damage: 150, cooldown: 60000 }
                }
            },
            zenitsu: {
                name: '아가츠마 젠이츠',
                hp: 800,
                atk: 150,
                def: 30,
                speed: 110,
                color: '#f1c40f',
                description: '번개의 호흡으로 순간 폭발 데미지를 내는 유리대포형',
                skills: {
                    basic: { name: '번개의 호흡, 제1형: 벽력일섬', damage: 150, cooldown: 1500 },
                    skill1: { name: '벽력일섬, 육연', damage: 50, cooldown: 12000 },
                    skill2: { name: '벽력일섬, 신속', damage: 250, cooldown: 15000 },
                    ultimate: { name: '번개의 호흡, 제7형: 화뢰신', damage: 500, cooldown: 60000 }
                }
            },
            akaza: {
                name: '아카자',
                hp: 1200,
                atk: 120,
                def: 70,
                speed: 90,
                color: '#e74c3c',
                description: '파괴살로 근접전을 압박하는 탱커형',
                skills: {
                    basic: { name: '파괴살: 근접 난타', damage: 60, cooldown: 1000 },
                    skill1: { name: '파괴살, 공식', damage: 150, cooldown: 7000 },
                    skill2: { name: '파괴살, 난식', damage: 80, cooldown: 10000 },
                    ultimate: { name: '파괴살, 멸식', damage: 600, cooldown: 70000 }
                }
            },
            doma: {
                name: '도우마',
                hp: 900,
                atk: 80,
                def: 40,
                speed: 105,
                color: '#9b59b6',
                description: '빙결의 혈귀술로 지역을 장악하는 조닝형',
                skills: {
                    basic: { name: '철선 휘두르기', damage: 70, cooldown: 1000 },
                    skill1: { name: '혈귀술, 흩날리는 연꽃', damage: 100, cooldown: 8000 },
                    skill2: { name: '혈귀술, 겨울철 고드름', damage: 150, cooldown: 12000 },
                    ultimate: { name: '혈귀술, 혹한의 겨울 여신', damage: 50, cooldown: 60000 }
                }
            }
        };

        // 장애물 데이터
        const obstacles = [
            { x: 200, y: 150, width: 80, height: 80 },
            { x: 500, y: 200, width: 60, height: 120 },
            { x: 300, y: 400, width: 100, height: 60 },
            { x: 700, y: 100, width: 80, height: 80 },
            { x: 150, y: 450, width: 120, height: 40 },
            { x: 800, y: 350, width: 70, height: 90 }
        ];
    </script>

    <!-- 클라이언트 스크립트 -->
    <script src="client.js"></script>
    <script src="ui.js"></script>
    
    <script>
        // 게임 초기화
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // 로그 함수
        function addLog(message, type = 'normal') {
            const log = document.getElementById('gameLog');
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            
            if (type === 'damage') div.classList.add('damage');
            else if (type === 'skill') div.classList.add('skill');
            else if (type === 'victory') div.classList.add('victory');
            
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
            
            if (log.children.length > 100) {
                log.removeChild(log.firstChild);
            }
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', () => {
            initOnlineGame();
            setupUI();
            addLog('귀멸의 칼날: 혈귀 대결에 오신 것을 환영합니다!');
        });
    </script>
</body>
</html>
